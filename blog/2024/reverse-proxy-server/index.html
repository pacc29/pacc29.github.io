<!DOCTYPE html> <html> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title> Alojando un sitio web casero con Cloudflare | Piero Carneiro </title> <meta name="author" content="Piero Carneiro"> <meta name="description" content="A simple, whitespace theme for academics. Based on [*folio](https://github.com/bogoli/-folio) design. "> <meta name="keywords" content="Portafolio"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link defer rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons&amp;display=swap"> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?591dab5a4e56573bf4ef7fd332894c99" media="" id="highlight_theme_light"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://pierocarneiro.xyz/blog/2024/reverse-proxy-server/"> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?5847e5ed4a4568527aa6cfab446049ca" media="none" id="highlight_theme_dark"> <script src="/assets/js/theme.js?0afe9f0ae161375728f7bcc5eb5b4ab4"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?85ddb88934d28b74e78031fd54cf8308"></script> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script> <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script src="/assets/js/distillpub/template.v2.js"></script> <script src="/assets/js/distillpub/transforms.v2.js"></script> <script src="/assets/js/distillpub/overrides.js"></script> </head> <body> <d-front-matter> <script async type="text/json">
      {
            "title": "Alojando un sitio web casero con Cloudflare",
            "description": "",
            "published": "March 21, 2024",
            "authors": [
              
              {
                "author": "Piero Carneiro",
                "authorURL": "",
                "affiliations": [
                  {
                    "name": "",
                    "url": ""
                  }
                ]
              }
              
            ],
            "katex": {
              "delimiters": [
                {
                  "left": "$",
                  "right": "$",
                  "display": false
                },
                {
                  "left": "$$",
                  "right": "$$",
                  "display": true
                }
              ]
            }
          }
    </script> </d-front-matter> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"> Piero Carneiro </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">Acerca de mí </a> </li> <li class="nav-item "> <a class="nav-link" href="/blog/">Blog </a> </li> <li class="nav-item "> <a class="nav-link" href="/repositorio/">Github Repo </a> </li> <li class="nav-item "> <a class="nav-link" href="/cv/">CV </a> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="fa-solid fa-moon"></i> <i class="fa-solid fa-sun"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="post distill"> <d-title> <h1>Alojando un sitio web casero con Cloudflare</h1> <p></p> </d-title> <d-byline></d-byline> <d-article> <d-contents> <nav class="l-text figcaption"> <h3>Contenido</h3> <div> <a href="#introducci%C3%B3n">Introducción</a> </div> <div> <a href="#qu%C3%A9-es-un-servidor-proxy-inverso">¿Qué es un servidor proxy inverso?</a> </div> <div> <a href="#requisitos">Requisitos</a> </div> <div> <a href="#manos-a-la-obra">Manos a la obra</a> </div> <ul> <li> <a href="#configurando-los-nameservers-en-el-dominio">Configurando los nameservers en el dominio</a> </li> <li> <a href="#instalando-el-daemon-cloudflared-en-linux">Instalando el Daemon Cloudflared en Linux</a> </li> </ul> </nav> </d-contents> <h2 id="alojando-un-sitio-web-casero-con-cloudflare">Alojando un sitio web casero con Cloudflare</h2> <h3 id="introducción">Introducción</h3> <p>En esta entrada explicaré con el mayor detalle posible mi experiencia y las dificultades que encontré en el camino hacia el Self-Hosting.</p> <p>El concepto de Self-Hosting implica tener una mayor autonomía (y responsabilidad) en la gestión del servidor, aplicaciones y datos almacenados, algo de lo cual generalmente se encarga en mayor o menor medida un proveedor de hosting.</p> <p>Primero quisiera definir algunos términos y establecer algunos requisitos para tener una idea general del proyecto. Cabe mencionar que los requisitos a mencionar a continuación están en función de lo que yo utilicé y tenía a la mano en aquel entonces; por ello, tales requisitos no deben ser considerados estáticos ni mucho menos la única vía al Self-Hosting.</p> <h3 id="qué-es-un-servidor-proxy-inverso">¿Qué es un servidor proxy inverso?</h3> <p>Un servidor proxy inverso es aquel que actúa en nombre uno o más servidores web, interceptando las peticiones de los clientes para luego enviar y/o recibir peticiones hacia/desde el servidor de origen, respectivamente. Por lo tanto el cliente nunca interactúa directamente con el servidor, sino que siempre hay un intermediario al cual se le conoce como <em>“Man-in-the-middle”</em> <d-footnote>Sólo si tienes la absoluta certeza que este middleman es de confiar.</d-footnote> (MitM). Aunque la seguridad no fue mi principal preocupación al considerar dicha tecnología en mi proyecto, creo que vale la pena resaltar que esto añade una “capa de protección”* al evitar la comunicación directa entre cliente-servidor.</p> <div class="row"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/reverse-proxy-server/reverse_proxy_flow-480.webp 480w,/assets/img/reverse-proxy-server/reverse_proxy_flow-800.webp 800w,/assets/img/reverse-proxy-server/reverse_proxy_flow-1400.webp 1400w," sizes="95vw" type="image/webp"></source> <img src="/assets/img/reverse-proxy-server/reverse_proxy_flow.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="Flujo de un servidor proxy inverso" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <div class="caption"> Flujo de un servidor proxy inverso<d-footnote>Imagen propiedad de Cloudflare.</d-footnote> </div> <p>La verdadera razón por la que considero esta tecnología como la solución ideal a mi proyecto es porque, al igual que a muchos de nosotros, mi proveedor de internet aplica CGNAT. CGNAT es una variante de NAT utilizada por los proveedores de internet para que múltiples usuarios de su servicio compartan una misma IP pública. Si este no fuese mi caso probablemente no tendría justificación para elaborar este post.</p> <h3 id="requisitos">Requisitos</h3> <p>Como mencioné anteriormente, voy a listar aquello que usé pero que no se limita únicamente a ello:</p> <ul> <li>Poseer un dominio de cualquier proveedor <ul> <li>Que permita cambiar los nameservers</li> </ul> </li> <li>Raspberry Pi Zero 2W, o cualquier computadora con una distribución de Linux <ul> <li>Tener el SO ya instalado y con permisos de administrador</li> </ul> </li> <li>Una cuenta gratiuita en <a href="https://dash.cloudflare.com/sign-up" rel="external nofollow noopener" target="_blank">Cloudflare</a> </li> </ul> <h3 id="manos-a-la-obra">Manos a la obra</h3> <h4 id="configurando-los-nameservers-en-el-dominio">Configurando los nameservers en el dominio</h4> <p>Primero ingresamos a nuestro <a href="https://dash.cloudflare.com/" rel="external nofollow noopener" target="_blank">dashboard</a> de Cloudflare y agregamos un sitio; en este caso sería el dominio que tenemos. En mi caso sería esta misma url <code class="language-plaintext highlighter-rouge">pierocarneiro.xyz</code> y seleccionamos el plan gratuito. Si luego nos aparecen más opciones por seleccionar (como los DNS records) lo ignoramos temporalmente hasta que Cloudflare nos redirija al dashboard. En el sidepanel hacemos click en <strong>DNS-&gt;Records</strong>.</p> <div class="row"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/reverse-proxy-server/dns-records-480.webp 480w,/assets/img/reverse-proxy-server/dns-records-800.webp 800w,/assets/img/reverse-proxy-server/dns-records-1400.webp 1400w," sizes="95vw" type="image/webp"></source> <img src="/assets/img/reverse-proxy-server/dns-records.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="DNS Records" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <p>Como podemos observar, Cloudflare ofrece sus procios nameservers, los cuales vamos a usar para reemplazar lo que ofrece por defecto nuestro proveedor de dominio.</p> <p>El paso a continuación puede ser diferente por el simple hecho que las interfaces de los proveedores de dominio varia de uno en uno, por lo que espero comprendan que es básicamente imposible cubrir todos los escenarios. Aun así, considero que tratar de explicarlo servirá como una guía. En mi caso estoy utilizando porkbun.</p> <div class="row"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/reverse-proxy-server/porkbun-480.webp 480w,/assets/img/reverse-proxy-server/porkbun-800.webp 800w,/assets/img/reverse-proxy-server/porkbun-1400.webp 1400w," sizes="95vw" type="image/webp"></source> <img src="/assets/img/reverse-proxy-server/porkbun.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="Dashboard de porkbun" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <div class="caption"> Dashboard de Porkbun<d-footnote>Otros proveedores ofrecen funcionalidades similares.</d-footnote> </div> <p>Ahora vamos cambiar los nameservers. Como indica la flecha roja, hacemos click en <strong>nameservers</strong> y nos aparecerá un recuadro con los nameservers utilizados actualmente. Algunos proveedores utilizan sus propios nameservers (como es el caso de Porkbun). Los borramos y copiamos los nameservers de Cloudflare que ha designado cuando se agregó un nuevo dominio: <code class="language-plaintext highlighter-rouge">fish.ns.cloudflare.com</code> y <code class="language-plaintext highlighter-rouge">mustafa.ns.cloudflare.com</code>.</p> <p>Por último, volvemos a nuestro dashboard en Cloudflare, específicamente regresamos a <strong>DNS-&gt;Records</strong> para eliminar los DNS records dentro del apartado <strong>DNS Management for…</strong>. En caso de haber algunos, los podemos borrar con el botón de editar bajo la columna <strong>actions</strong>. Hacer esto con todas las entradas listadas hasta que quede totalmente vacío.</p> <h4 id="instalando-el-daemon-cloudflared-en-linux">Instalando el Daemon Cloudflared en Linux</h4> </d-article> <d-appendix> <d-footnote-list></d-footnote-list> <d-citation-list></d-citation-list> </d-appendix> <d-bibliography src="/assets/bibliography/"></d-bibliography> </div> <footer class="sticky-bottom mt-5" role="contentinfo"> <div class="container"> © Copyright 2024 Piero Carneiro. Last updated: April 21, 2024. </div> </footer> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script async src="https://www.googletagmanager.com/gtag/js?id="></script> <script>function gtag(){window.dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","");</script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> </body> </html>